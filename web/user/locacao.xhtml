<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/Layout.xhtml">

    <ui:define name="content">


        <script type="text/javascript">
            function handleDialogSubmit(xhr, status, args) {
                if (args.validationFailed) {
                    PF('dlgLocacao').show();
                } else {
                    PF('dlgLocacao').hide();
                }
            }
        </script>

        <h1 class="aw-page-title">Locação</h1>

        <h:form id="cadButton">

            <p:commandButton value="Nova Locação" onclick="PF('dlgLocacao').show();" icon="fa fa-user-plus" styleClass="ui-color-green" />

        </h:form><br/>

        <!--DIALOG CADASTRO-->
        <p:dialog header="Nova Locação" widgetVar="dlgLocacao" modal="true" height="320"  width="800" >

            <p:messages id="messages" showDetail="true" closable="true">
                <p:autoUpdate />
            </p:messages>

            <h:form id="formularioCabecalhoLocacao">

                <h:panelGrid columns="2">

                    <h:outputLabel for="selectOneMenuCliente" value="Locador:" />
                    <p:selectOneMenu id="selectOneMenuCliente" value="#{locacaoMB.locacao.dependente}"
                                     converter="converterDependente"
                                     filter="true"
                                     filterMatchMode="startsWith"
                                     disabled="#{locacaoMB.listItensLocacao.size() > 0}"
                                     required="true"
                                     requiredMessage="Selecione um Locador">
                        <f:selectItem itemLabel="Selecione um Locador" itemValue=""/>
                        <f:selectItems value="#{dependenteMB.listDependente}" var="obj" 
                                       itemLabel="#{obj.nome} - #{obj.cliente.nome} - #{textFormaterService.formatCPF(obj.cliente.cpf)}"
                                       itemValue="#{obj}"/>
                        <f:ajax render="cadastroSelectOneMidia" listener="#{locacaoMB.updateValidMidias()}"/>
                    </p:selectOneMenu>

                    <h:outputLabel for="calendarDataLocacao" value="Data de Locação:" />
                    <p:calendar id="calendarDataLocacao" 
                                pattern="dd/MM/yyyy" 
                                value="#{locacaoMB.locacao.dataLocacao}" 
                                mask="true"
                                required="true"
                                requiredMessage="Preencha o campo Data de Locação"/>

                    <h:outputLabel for="calendarDataDevolucao" value="Data de Devolução:" />
                    <p:calendar id="calendarDataDevolucao" 
                                pattern="dd/MM/yyyy" 
                                value="#{locacaoMB.locacao.dataPrevDevolucao}" 
                                mask="true"
                                required="true"
                                requiredMessage="Preencha o campo Data de Devolução"/>

                </h:panelGrid>

                <div style="border: 0.5px solid black; width: 99%; margin-top: 10px"></div>
                <br/>

                <!-- 		INÍCIO DE MIDIAS -->
                <h:panelGrid columns="4">
                    
                    <h:outputText value="Midia: " />
                    <p:selectOneMenu id="cadastroSelectOneMidia" value="#{locacaoMB.midia}"
                                     filter="true"
                                     filterMatchMode="startsWith"
                                     disabled="#{locacaoMB.locacao.dependente == null}"
                                     converter="converterMidia">
                        <f:selectItem itemLabel="Selecione uma midia" itemValue="" />
                        <f:selectItems value="#{locacaoMB.midiasDisponiveis}" var="obj"
                                       itemLabel="#{obj.id} - #{obj.acervo.nome} - #{obj.tipo}"
                                       itemValue="#{obj}"/>
                        <f:ajax listener="#{locacaoMB.definirItemLocacao()}" render="valorItemLocacao"/>
                    </p:selectOneMenu>
                   
                    <p:inputNumber id="valorItemLocacao" placeholder="Preço" value="#{locacaoMB.itemLocacao.preco}" symbol="R$ " />

                    <p:commandButton value="Adicionar" update="@form"
                                     actionListener="#{locacaoMB.adicionarItemLocacao()}"/>

                </h:panelGrid>

                <br/>

                <p:dataTable id="tabelaItensLocacao" value="#{locacaoMB.listItensLocacao}" var="obj">

                    <p:column headerText="ID">
                        <h:outputText value="#{obj.midia.id}" />
                    </p:column>

                    <p:column headerText="Nome">
                        <h:outputText value="#{obj.midia.acervo.nome}" />
                    </p:column>		

                    <p:column headerText="Tipo">
                        <h:outputText value="#{obj.midia.tipo}" />
                    </p:column>		

                    <p:column headerText="Data de Lançamento">
                        <h:outputText value="#{textFormaterService.formatData(obj.midia.acervo.dataLancamento)}" />
                    </p:column>

                    <p:column headerText="Preço">
                        <h:outputText value="R$ #{textFormaterService.formatDinheiro(obj.preco)}" />
                    </p:column>

                    <p:column headerText="Ações">

                        <!--BOTÃO EXCLUIR-->
                        <p:commandButton title="Excluir" icon="fa fa-trash"  
                                         actionListener="#{locacaoMB.removerItemLocacao(obj)}" 
                                         update="@form" 
                                         styleClass="ui-color-red"/>

                    </p:column>

                </p:dataTable>
                <!-- 		FIM DE MIDIAS -->

                <br/>

                <p:commandButton value="Finalizar Locação" 
                                 actionListener="#{locacaoMB.cadastrar()}"
                                 oncomplete="handleDialogSubmit(xhr, status, args)"
                                 update="@form"/> 

                <h:outputText value="Total: R$ #{textFormaterService.formatDinheiro(locacaoMB.locacao.precoLocacao)}" 
                              style="float:right;font-size: 16px"/>

            </h:form>

        </p:dialog>

        <!--DIALOG ALTERAR-->
        <p:dialog header="Alterar Locação" widgetVar="dlgAlterarLocacao" modal="true" height="300" width="800" >

            <p:messages id="messagesAlterar" showDetail="true" closable="true">
                <p:autoUpdate />
            </p:messages>

            <h:form id="formularioCabecalhoLocacaoAlterar">

                <h:panelGrid columns="2">

                    <!--Tem que alterar algumas coisas de acordo com oq foi alterado no dialog de cadastro-->
                    <h:outputLabel for="selectOneMenuClienteAlterar" value="Cliente:" />
                    <p:selectOneMenu id="selectOneMenuClienteAlterar" value="#"
                                     filter="true"
                                     filterMatchMode="startsWith">
                        <f:selectItem itemLabel="Selecione um Cliente" itemValue=""/>

                    </p:selectOneMenu>

                    <h:outputLabel for="calendarDataLocacaoAlterar" value="Data de Locação:" />
                    <p:calendar id="calendarDataLocacaoAlterar" pattern="dd/MM/yyyy" value="" mask="true"/>

                    <h:outputLabel for="calendarDataDevolucaoAlterar" value="Data de Devolução:" />
                    <p:calendar id="calendarDataDevolucaoAlterar" pattern="dd/MM/yyyy" value="" mask="true"/>

                </h:panelGrid>

                <div style="border: 0.5px solid black; width: 99%; margin-top: 10px"></div>
                <br/>

                <!-- 		INÍCIO DE MIDIAS -->
                <h:panelGrid columns="4">
                    <h:outputText value="Midia: " />
                    <p:selectOneMenu value="#"
                                     filter="true"
                                     filterMatchMode="startsWith">
                        <f:selectItem itemLabel="123123 - Harry Potter - Disponibilidade" itemValue="" />
                        <f:selectItem itemLabel="675645 - Senhor dos anéis - Disponibilidade" itemValue="" />
                    </p:selectOneMenu>

                    <p:inputNumber id="valorItemLocacaoAlterar" placeholder="Preço" value="" symbol="R$ " />

                    <p:commandButton value="Adicionar" update=""
                                     actionListener="#"/>

                </h:panelGrid>

                <br/>

                <p:dataTable id="tabelaItensLocacaoAlterar" value="#" var="obj">

                    <p:column headerText="ID">
                        <h:outputText value="12312" />
                    </p:column>

                    <p:column headerText="Nome">
                        <h:outputText value="1" />
                    </p:column>		

                    <p:column headerText="Tipo">
                        <h:outputText value="DVD" />
                    </p:column>		

                    <p:column headerText="Data de Lançamento">
                        <h:outputText value="02/02/2002" />
                    </p:column>

                    <p:column headerText="Preço">
                        <h:outputText value="02/02/2002" />
                    </p:column>

                    <p:column headerText="Ações">

                        <!--BOTÃO ALTERAR-->
                        <p:commandButton title="Alterar" icon="fa fa-pencil" update="@form" styleClass="ui-priority-primary" onclick="PF('dlg3').show();">

                            <f:setPropertyActionListener value="#" target="#"/>

                        </p:commandButton>

                        <!--BOTÃO EXCLUIR-->
                        <p:commandButton title="Excluir" icon="fa fa-trash"  actionListener="#" update="@form" styleClass="ui-color-red" >


                        </p:commandButton>

                    </p:column>

                </p:dataTable>
                <!-- 		FIM DE MIDIAS -->

                <br/>

                <p:commandButton value="Finalizar Alteração" 
                                 actionListener="#" 
                                 update=""/> 

                <h:outputText value="Total: R$ 000,00" style="float:right;font-size: 16px"/>

            </h:form>

        </p:dialog>

        <!--DIALOG DETALHES-->
        <p:dialog header="Detalhes Locação" widgetVar="dlgDetalhesLocacao" modal="true" height="300" width="800" >

            <!--Se não funcionario pode ser pq nao ta dentro de um form-->

            <!--Informações Gerais-->
            <h:panelGrid columns="2">

                <h:outputLabel for="detalhesID" value="ID:" />
                <h:outputText id="detalhesID" value="123123"/>

                <h:outputLabel for="detalhesStatus" value="Status:" />
                <h:outputText id="detalhesStatus" value="Reserva"/>

                <h:outputLabel for="detalhesLocador" value="Locador:" />
                <h:outputText id="detalhesLocador" value="Carinha"/>

                <h:outputLabel for="detalhesDataLocacao" value="Data de Locação:" />
                <h:outputText id="detalhesDataLocacao" value="12/11/1111"/>

                <h:outputLabel for="detalhesDataPrevDevolucao" value="Data de Devolução Prevista:" />
                <h:outputText id="detalhesDataPrevDevolucao" value="16/11/1111"/>

                <h:outputLabel for="detalhesDataDevolucao" value="Data de Devolução:" />
                <h:outputText id="detalhesDataDevolucao" value="16/11/1111"/>

                <h:outputLabel for="detalhesDataPagamento" value="Data de Pagamento:" />
                <h:outputText id="detalhesDataPagamento" value="16/11/1111"/>

            </h:panelGrid>

            <br/>

            <!--Itens de Locação-->
            <p:dataTable id="tabelaItensLocacaoDetalhes" value="#" var="obj">

                <p:column headerText="ID">
                    <h:outputText value="12312" />
                </p:column>

                <p:column headerText="Nome">
                    <h:outputText value="1" />
                </p:column>		

                <p:column headerText="Tipo">
                    <h:outputText value="DVD" />
                </p:column>		

                <p:column headerText="Data de Lançamento">
                    <h:outputText value="02/02/2002" />
                </p:column>

                <p:column headerText="Gênero">
                    <h:outputText value="Ação" />
                </p:column>

                <p:column headerText="Classificação Etária">
                    <h:outputText value="Livre" />
                </p:column>

                <p:column headerText="Preço">
                    <h:outputText value="02/02/2002" />
                </p:column>

            </p:dataTable>

            <br/>
            
            <!--Informações de Multa-->
            <h:panelGrid columns="2">

                <f:facet name="header">
                    <h:outputText value="Multa"/>
                </f:facet>
                
                <h:outputLabel for="detalhesDescricaoMulta" value="Descrição:" />
                <h:outputText id="detalhesDescricaoMulta" value="Disco zuado"/>

                <h:outputLabel for="detalhesValorMulta" value="Valor da multa:" />
                <h:outputText id="detalhesValorMulta" value="R$ 1231,32"/>

            </h:panelGrid>
            
            <!--Informações de Preço-->
            
            <h:panelGrid columns="2">

                <h:outputLabel for="detalhesPrecoLocacao" value="Preço da Locação:" />
                <h:outputText id="detalhesPrecoLocacao" value="R$ 2312,32"/>

                <h:outputLabel for="detalhesValorPago" value="Valor Pago:" />
                <h:outputText id="detalhesValorPago" value="R$ 1231,32"/>

            </h:panelGrid>

        </p:dialog>

        <!--TABELA PRINCIPAL-->
        <h:form id="formTabela">

            <p:dataTable value="" var="locao">

                <p:column headerText="ID">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Data de Locação">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Data de Devolução Prevista">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Data de Devolução">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Locador">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Status">
                    <!--Mostrar se é uma reserva, locacao corrente ou locacao concluida-->
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Preço">
                    <h:outputText value=""/>
                </p:column>

                <p:column headerText="Ações">

                    <!--BOTÃO DETALHES-->
                    <p:commandButton title="Detalhes" icon="fa fa-envelope-o" update="@form, " styleClass="ui-color-orange" onclick="PF('dlgDetalhesLocacao').show();">

                        <f:setPropertyActionListener value="#" target="#"/>

                    </p:commandButton>

                    <!--BOTÃO ALTERAR-->
                    <p:commandButton title="Alterar" icon="fa fa-pencil" update="@form, " styleClass="ui-priority-primary" onclick="PF('dlgAlterarLocacao').show();">

                        <f:setPropertyActionListener value="#" target="#"/>

                    </p:commandButton>

                    <!--BOTÃO EXCLUIR-->
                    <!--Deixar excluir somente quando o a data de locacao for <= hoje-->
                    <p:commandButton title="Excluir" icon="fa fa-trash"  actionListener="#" update="@form" styleClass="ui-color-red" >

                        <p:confirm header="Confirmação" 
                                   message="Deseja excluir o dependente?"
                                   icon="ui-icon-alert"/>

                    </p:commandButton>

                </p:column>

            </p:dataTable>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sim" type="button"
                                 styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="Não" type="button"
                                 styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>

        </h:form>

    </ui:define>

</ui:composition>